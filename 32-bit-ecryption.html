<!--
  Author: Mike Jonas
  Date: 9/24/14
  Purpose: TBD

  Modified: Kevin Booth
  Date: 9/11/19
-->

<html>
  <head>
    <title>Encrypt/Decrypt</title>
    <script language="JavaScript">
      <!--
        var seed = 1;
	      var N = 2147483647;
        var P1 = 16807;
        var P2 = 1;
    
        function getRandom () {
          seed = (P2 + (P1 * seed)) % N;

          return seed;
        }

        function hash (pass) {
          var value = 0;

          for (var i = 0; i < pass.length; i++)
          {
            value += pass.charCodeAt(i) * (i + 1);
          }

          return value;
        }
        
        // C = E(M)
        function encryptStr () {
          var msg = document.info.source.value;  // M
          var cyph = "";  // C
          var ascii;
          var shift;
          
          seed = hash(document.info.passwd.value);
          
          for (var i=0; i<msg.length; i++) {
            ascii = msg.charCodeAt(i);
            ascii = ascii - 32;  // normalize start to 0
            
            shift = getRandom() % 95;
            
            ascii = (ascii + shift) % 95;
            ascii = ascii + 32;  // unormalize back to 32
            
            cyph = cyph + String.fromCharCode(ascii);
          }
          
          document.info.source.value = ''; // make encrypt input field empty
          document.info.dest.value = cyph;
        }
        
        // M = D(C)
        function decryptStr () {
          var msg = "";  // M
          var cyph = document.info.dest.value;  // C
          var ascii;
          var shift;

          seed = hash(document.info.passwd.value);
          
          for(var i = 0; i<cyph.length; i++) {
            ascii = cyph.charCodeAt(i) - 32;
            shift = (ascii + (95 - (getRandom() % 95))) % 95;
            ascii = shift + 32;

            msg = msg + String.fromCharCode(ascii);
          }

          document.info.source.value = msg;
          document.info.dest.value = ''; // make decrypt input field empty
        }
      -->
    </script>
  </head>

  <body>
    <form name="info">
      Password:
      <input type="text"
         name="passwd"
         value="">
      <br>

      <input type="text"
         name="source"
         value="">
      <input type="button"
         name="encrypt"
         value="Encrypt"
         onclick="encryptStr();">
      <br>

      <input type="text"
         name="dest"
         value="">
      <input type="button"
         name="decrypt"
         value="Decrypt"
         onclick="decryptStr();">
    </form>
  </body>
</html>
